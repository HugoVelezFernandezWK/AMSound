
-- Script de creación de base de datos AM SOUND
-- Hugo Vélez Fernández
-- V 1.0 - 07/03/2024

-- DROP DATABASE IF EXISTS AMSOUND;
-- CREATE DATABASE AMSOUND;
-- USE AMSOUND;

DROP TABLE COMPONENTE_VOZ;
DROP TABLE RECURSO;
DROP TABLE VOZ;
DROP TABLE PIEZA_MUSICAL;
DROP TABLE AGRUPACION;
DROP TABLE USUARIO;

DROP SEQUENCE SEQ_USUARIO;
DROP SEQUENCE SEQ_PIEZA_MUSICAL;
DROP SEQUENCE SEQ_AGRUPACION;
DROP SEQUENCE SEQ_VOZ;
DROP SEQUENCE SEQ_COMPONENTE_VOZ;
DROP SEQUENCE SEQ_RECURSO;

CREATE TABLE USUARIO (
    ID NUMBER(6,0) PRIMARY KEY,
    NOMBRE VARCHAR2(64) NOT NULL,
    MAIL VARCHAR2(255) NOT NULL UNIQUE,
    TELEFONO CHAR(9) UNIQUE,
    CONTRASENA CHAR(64) NOT NULL,
    FOTO VARCHAR2(255),

    CONSTRAINT "ValidarMail" CHECK (MAIL LIKE '%@%.%')
);

CREATE TABLE AGRUPACION (
    ID NUMBER(6,0) PRIMARY KEY,
    NOMBRE VARCHAR2(64) NOT NULL UNIQUE,
    CONTACTO VARCHAR2(255) NOT NULL,
    TEXTO VARCHAR2(255),
    FOTO VARCHAR2(255),
    DIRECTOR_DE_AGRUPACION NUMBER(6) NOT NULL,

    FOREIGN KEY (DIRECTOR_DE_AGRUPACION) REFERENCES USUARIO(ID)
);

CREATE TABLE PIEZA_MUSICAL (
    ID NUMBER(6,0) PRIMARY KEY,
    NOMBRE VARCHAR2(64) NOT NULL,
    AUTOR VARCHAR2(64) NOT NULL,
    TEXTO VARCHAR2(255),
    PIEZA_DE_AGRUPACION NUMBER(6) NOT NULL,
    
    FOREIGN KEY (PIEZA_DE_AGRUPACION) REFERENCES AGRUPACION(ID)
);

CREATE TABLE VOZ (
    ID NUMBER(6,0) PRIMARY KEY,
    NOMBRE VARCHAR2(64) NOT NULL,
    TEXTO VARCHAR2(255),
    VOZ_DE_AGRUPACION NUMBER(6) NOT NULL,

    FOREIGN KEY (VOZ_DE_AGRUPACION) REFERENCES AGRUPACION(ID)
);

CREATE TABLE RECURSO (
    ID NUMBER(8,0) PRIMARY KEY,
    TITULO VARCHAR2(64) NOT NULL,
    RUTA_ARCHIVO VARCHAR2(255) NOT NULL,
    TEXTO VARCHAR2(255),
    VOZ_DE_RECURSO NUMBER(6) NOT NULL,
    PIEZA_DE_RECURSO NUMBER(6) NOT NULL,

    FOREIGN KEY (VOZ_DE_RECURSO) REFERENCES VOZ(ID),
    FOREIGN KEY (PIEZA_DE_RECURSO) REFERENCES PIEZA_MUSICAL(ID)
);

CREATE TABLE COMPONENTE_VOZ (
    ID NUMBER(6,0) PRIMARY KEY,
    USUARIO_COMPONENTE NUMBER(6) NOT NULL,
    VOZ NUMBER(6) NOT NULL,

    FOREIGN KEY (USUARIO_COMPONENTE) REFERENCES USUARIO(ID),
    FOREIGN KEY (VOZ) REFERENCES VOZ(ID),
    
    -- Restricción de unicidad compuesta
    CONSTRAINT unique_usuario_voz UNIQUE (USUARIO_COMPONENTE, VOZ)
);

CREATE SEQUENCE SEQ_USUARIO INCREMENT BY 1 START WITH 10 MAXVALUE 999999 CYCLE;
CREATE SEQUENCE SEQ_PIEZA_MUSICAL INCREMENT BY 1 START WITH 10 MAXVALUE 999999 CYCLE;
CREATE SEQUENCE SEQ_AGRUPACION INCREMENT BY 1 START WITH 10 MAXVALUE 999999 CYCLE;
CREATE SEQUENCE SEQ_VOZ INCREMENT BY 1 START WITH 10 MAXVALUE 999999 CYCLE;
CREATE SEQUENCE SEQ_COMPONENTE_VOZ INCREMENT BY 1 START WITH 10 MAXVALUE 999999 CYCLE;
CREATE SEQUENCE SEQ_RECURSO INCREMENT BY 1 START WITH 10 MAXVALUE 99999999 CYCLE;

INSERT INTO "AMSOUND"."USUARIO" (ID, NOMBRE, MAIL, TELEFONO, CONTRASENA, FOTO) VALUES (1, 'Juan Antonio Diaz', 'juanantoniodiaz@gmail.com', '663142315', '1234', NULL);
INSERT INTO "AMSOUND"."USUARIO" (ID, NOMBRE, MAIL, TELEFONO, CONTRASENA, FOTO) VALUES (2, 'Hugo Vélez Fernández', 'hugovfwk@gmail.com', '603441021', 'kk', NULL);
INSERT INTO "AMSOUND"."USUARIO" (ID, NOMBRE, MAIL, TELEFONO, CONTRASENA, FOTO) VALUES (3, 'Andrea', 'andrea@gmail.com', NULL, '1234', NULL);
INSERT INTO "AMSOUND"."USUARIO" (ID, NOMBRE, MAIL, TELEFONO, CONTRASENA, FOTO) VALUES (4, 'Clemente', 'clemente@gmail.com', NULL, '1234', NULL);
INSERT INTO "AMSOUND"."USUARIO" (ID, NOMBRE, MAIL, TELEFONO, CONTRASENA, FOTO) VALUES (5, 'Andres', 'andres@gmail.com', NULL, '1234', NULL);
INSERT INTO "AMSOUND"."USUARIO" (ID, NOMBRE, MAIL, TELEFONO, CONTRASENA, FOTO) VALUES (6, 'Jorge', 'jorje@gmail.com', NULL, '1234', NULL);

INSERT INTO "AMSOUND"."AGRUPACION" (ID, NOMBRE, CONTACTO, TEXTO, FOTO, DIRECTOR_DE_AGRUPACION) VALUES (1,'AM Buena Muerte (Ayamonte)', 'ambuenamuerteayamonte@gmail.com', NULL, NULL, 1);
INSERT INTO "AMSOUND"."AGRUPACION" (ID, NOMBRE, CONTACTO, TEXTO, FOTO, DIRECTOR_DE_AGRUPACION) VALUES (2,'AM Buena Muerte (Ayamonte) 2', 'ambuenamuerteayamonte2@gmail.com', NULL, NULL, 2);

INSERT INTO "AMSOUND"."VOZ" (ID, NOMBRE, TEXTO, VOZ_DE_AGRUPACION) VALUES (1, 'Trompeta 1º', NULL, 1);
INSERT INTO "AMSOUND"."VOZ" (ID, NOMBRE, TEXTO, VOZ_DE_AGRUPACION) VALUES (2, 'Corneta 1º', NULL, 1);
INSERT INTO "AMSOUND"."VOZ" (ID, NOMBRE, TEXTO, VOZ_DE_AGRUPACION) VALUES (3, 'Corneta 2º', NULL, 1);
INSERT INTO "AMSOUND"."VOZ" (ID, NOMBRE, TEXTO, VOZ_DE_AGRUPACION) VALUES (4, 'Tambor', NULL, 1);
INSERT INTO "AMSOUND"."VOZ" (ID, NOMBRE, TEXTO, VOZ_DE_AGRUPACION) VALUES (5, 'Tuba', NULL, 1);

INSERT INTO "AMSOUND"."PIEZA_MUSICAL" (ID, NOMBRE, AUTOR, TEXTO, PIEZA_DE_AGRUPACION) VALUES (1, 'Tras de Ti Mi Cautivo', 'José Manuel Sánchez Molero', NULL, 1);
INSERT INTO "AMSOUND"."PIEZA_MUSICAL" (ID, NOMBRE, AUTOR, TEXTO, PIEZA_DE_AGRUPACION) VALUES (2, 'Eres Mi Bendicion', 'José Manuel Sánchez Molero', NULL, 1);
INSERT INTO "AMSOUND"."PIEZA_MUSICAL" (ID, NOMBRE, AUTOR, TEXTO, PIEZA_DE_AGRUPACION) VALUES (3, 'El legado de un maestro', 'José Manuel Sánchez Molero', NULL, 1);
INSERT INTO "AMSOUND"."PIEZA_MUSICAL" (ID, NOMBRE, AUTOR, TEXTO, PIEZA_DE_AGRUPACION) VALUES (4, 'A Tus Pies Señora', 'José Manuel Sánchez Molero', NULL, 1);

INSERT INTO "AMSOUND"."RECURSO" (ID, TITULO, RUTA_ARCHIVO, TEXTO, VOZ_DE_RECURSO, PIEZA_DE_RECURSO) VALUES (1, 'Partitura Tras de Ti Mi Cautivo Corneta 1', 'trasdetimicautivo_corneta1.jpg', NULL, 2, 1);
INSERT INTO "AMSOUND"."RECURSO" (ID, TITULO, RUTA_ARCHIVO, TEXTO, VOZ_DE_RECURSO, PIEZA_DE_RECURSO) VALUES (2, 'Partitura Tras de Ti Mi Cautivo Corneta 2', 'trasdetimicautivo_corneta2.jpg', NULL, 3, 1);
INSERT INTO "AMSOUND"."RECURSO" (ID, TITULO, RUTA_ARCHIVO, TEXTO, VOZ_DE_RECURSO, PIEZA_DE_RECURSO) VALUES (3, 'Partitura Tras de Ti Mi Cautivo Trompeta 1', '/trasdetimicautivo_trompeta1.mp3', NULL, 1, 1);

INSERT INTO "AMSOUND"."COMPONENTE_VOZ" (ID, USUARIO_COMPONENTE, VOZ) VALUES (1, 2, 3);
INSERT INTO "AMSOUND"."COMPONENTE_VOZ" (ID, USUARIO_COMPONENTE, VOZ) VALUES (2, 3, 2);
INSERT INTO "AMSOUND"."COMPONENTE_VOZ" (ID, USUARIO_COMPONENTE, VOZ) VALUES (3, 4, 1);
INSERT INTO "AMSOUND"."COMPONENTE_VOZ" (ID, USUARIO_COMPONENTE, VOZ) VALUES (4, 5, 4);
INSERT INTO "AMSOUND"."COMPONENTE_VOZ" (ID, USUARIO_COMPONENTE, VOZ) VALUES (5, 6, 5);